<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ClimaArtifacts · ClimaUtilities.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaUtilities.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaUtilities.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>ClimaArtifacts</a><ul class="internal"><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../inputs/">Space and Time Inputs</a></li><li><a class="tocitem" href="../filereaders/">FileReaders</a></li><li><a class="tocitem" href="../datahandling/">DataHandling</a></li><li><a class="tocitem" href="../regridders/">Regridders</a></li><li><a class="tocitem" href="../outputpathgenerator/">OutputPathGenerator</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li><li><a class="tocitem" href="../faqs/">Frequently Asked Questions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>ClimaArtifacts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ClimaArtifacts</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaUtilities.jl/blob/main/docs/src/climaartifacts.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ClimaArtifacts"><a class="docs-heading-anchor" href="#ClimaArtifacts"><code>ClimaArtifacts</code></a><a id="ClimaArtifacts-1"></a><a class="docs-heading-anchor-permalink" href="#ClimaArtifacts" title="Permalink"></a></h1><p><a href="https://pkgdocs.julialang.org/v1/artifacts/">Julia artifacts</a> are pieces of data that can be distributed alongside a package. Julia artifacts were developed to distribute application binaries (e.g., compiled libraries). In <a href="https://github.com/CliMA"><code>CliMA</code></a>, we use them to distribute data required to perform our simulations (e.g., input data).</p><p>The <code>ClimaArtifacts</code> module extends the Julia artifact system to solve two issues:</p><ol><li>Ensuring that artifacts can be gracefully acquired by parallel runs;</li><li><em>Tagging</em> artifacts that are accessed during a simulation.</li></ol><p>We will examine these two problems below. In the meantime, this entire documentation page can be summarized in a one short directive for package developers:</p><blockquote><p>Instead of accessing artifacts with  <a href="https://github.com/CliMA/ArtifactWrappers.jl">ArtifactWrappers.jl</a> or using  Julia artifacts directly, use the <code>@clima_artifact</code> macro instead.</p></blockquote><p>Also, keep in mind that</p><blockquote><p>⚠️ Note: Julia artifacts are always entire folders, never single files!</p></blockquote><h3 id="Julia-artifacts-and-MPI"><a class="docs-heading-anchor" href="#Julia-artifacts-and-MPI">Julia artifacts and MPI</a><a id="Julia-artifacts-and-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-artifacts-and-MPI" title="Permalink"></a></h3><p>Package developers can specify one of two modes for any given artifact: greedy (default) or lazy download. Artifact that are not marked as <code>lazy</code> are automatically downloaded by Julia when the package is instantiated. On the other hand, <code>lazy</code> artifacts are downloaded the first time they are accessed.</p><p>CliMA packages can distribute tens of artifacts that are relevant for very different types of simulations, and it is a good idea to mark artifacts as <code>lazy</code> unless they are strictly required for the operation of the package (e.g., the orbital parameters in <a href="https://github.com/CliMA/Insolation.jl">Insolation.jl</a>).</p><p>Lazy artifacts are incompatible with MPI. In parallel runs, each process tries to download the same file, resulting in a race condition and corrupted files (not to mention tens of processing pinging the same server at the same time). <code>ClimaArtifacts</code> implements a new macro, <code>@clima_artifact</code>, to solve this problem.</p><p><code>@clima_artifact</code> is a near drop-in replacement for the <a href="https://docs.julialang.org/en/v1/stdlib/Artifacts/#Artifacts.@artifact_str"><code>@artifact_str</code></a> Julia macro.</p><p>For greedy artifacts and non-MPI runs, it is possible to simply call <code>@clima_artifact(artifact_name)</code>. This will return the path of the artifact folder. This macro will fail for lazy artifacts. In that case, one has to also pass the <a href="https://github.com/CliMA/ClimaComms.jl">ClimaComms.jl</a> <code>context</code>. The context is required because <code>@clima_artifact</code> needs to synchronize different MPI processes.</p><h4 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h4><blockquote><p>This extension is loaded when loading <code>ClimaComms</code></p></blockquote><p>Assume <code>socrates</code> is a lazy artifact, we can access the <code>socrates</code> artifact folder as in</p><pre><code class="language-julia hljs">using ClimaUtilities.ClimaArtifacts
# If the artifact is lazy, we also need LazyArtifacts
using LazyArtifacts

import ClimaComms
# When loading ClimaComms, a Julia extension for ClimaUtilities will be loaded

my_mpi_context = ClimaComms.context()

socrates_path_folder = @clima_artifact(&quot;socrates&quot;, context)</code></pre><p>The <code>@clima_artifact</code> macro is executed at parse time when the argument is a literal string (e.g., <code>@clima_artifact(&quot;socrates&quot;)</code>), and at runtime when it is a variable <code>@clima_artifact(artifact_name)</code>.</p><blockquote><p>Note: <code>context</code> is a positional argument, not a keyword one. Calling <code>@clima_artifact(&quot;socrates&quot;; context)</code> will fail. (This is due to how Julia macros handle keyword arguments)</p></blockquote><h3 id="Tagging-artifacts"><a class="docs-heading-anchor" href="#Tagging-artifacts">Tagging artifacts</a><a id="Tagging-artifacts-1"></a><a class="docs-heading-anchor-permalink" href="#Tagging-artifacts" title="Permalink"></a></h3><p>A full climate simulation requires lots of external input data. Most of this data comes from scientific experiments that have to be properly acknowledged. <code>ClimaArtifacts</code> allows users to know what artifacts were used in a given simulation. As long as artifacts are being accessed with <code>@clima_artifacts</code>, the <code>ClimaArtifacts</code> keeps track of what is being used. The set of artifacts accessed can be obtained with <code>ClimaArtifacts.accessed_artifacts</code>.</p><h4 id="Example-2"><a class="docs-heading-anchor" href="#Example-2">Example</a><a class="docs-heading-anchor-permalink" href="#Example-2" title="Permalink"></a></h4><pre><code class="language-julia hljs">using ClimaUtilities.ClimaArtifacts
art1 = @clima_artifact(&quot;socrates&quot;)
art2 = @clima_artifact(&quot;zeno&quot;)

ClimaArtifacts.accessed_artifacts()
# Set([&quot;socrates&quot;, &quot;zeno&quot;])</code></pre><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.ClimaArtifacts.@clima_artifact" href="#ClimaUtilities.ClimaArtifacts.@clima_artifact"><code>ClimaUtilities.ClimaArtifacts.@clima_artifact</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@clima_artifact(artifact_name, context = nothing)</code></pre><p>Return the path of the given artifact name. The path is always a folder (Julia artifacts can contain multiple files).</p><p>This macro plays nicely with MPI contexts and lazily downloaded artifacts. This is achieved by ensuring that only one process downloads the file, while the other wait until the file is fully downloaded.</p><p>Passing the context is required only for lazy artifacts.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/e1e822cbef149e0aaa4d0a7fc7e6fe07a2099ce4/src/ClimaArtifacts.jl#L24-L35">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.ClimaArtifacts.accessed_artifacts" href="#ClimaUtilities.ClimaArtifacts.accessed_artifacts"><code>ClimaUtilities.ClimaArtifacts.accessed_artifacts</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">accessed_artifacts()</code></pre><p>Return a set with the names of the artifacts accessed using the @clima_artifact macro.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/e1e822cbef149e0aaa4d0a7fc7e6fe07a2099ce4/src/ClimaArtifacts.jl#L12-L16">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../inputs/">Space and Time Inputs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 9 October 2024 22:24">Wednesday 9 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
