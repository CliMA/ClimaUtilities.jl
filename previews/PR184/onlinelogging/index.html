<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>OnlineLogging · ClimaUtilities.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaUtilities.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaUtilities.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../climaartifacts/">ClimaArtifacts</a></li><li><a class="tocitem" href="../inputs/">Space and Time Inputs</a></li><li><a class="tocitem" href="../filereaders/">FileReaders</a></li><li><a class="tocitem" href="../datahandling/">DataHandling</a></li><li><a class="tocitem" href="../regridders/">Regridders</a></li><li class="is-active"><a class="tocitem" href>OnlineLogging</a><ul class="internal"><li><a class="tocitem" href="#WallTimeInfo-and-report_walltime"><span><code>WallTimeInfo</code> and <code>report_walltime</code></span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../outputpathgenerator/">OutputPathGenerator</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li><li><a class="tocitem" href="../faqs/">Frequently Asked Questions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>OnlineLogging</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>OnlineLogging</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaUtilities.jl/blob/main/docs/src/onlinelogging.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Online-Simulation-Progress-Reporting"><a class="docs-heading-anchor" href="#Online-Simulation-Progress-Reporting">Online Simulation Progress Reporting</a><a id="Online-Simulation-Progress-Reporting-1"></a><a class="docs-heading-anchor-permalink" href="#Online-Simulation-Progress-Reporting" title="Permalink"></a></h1><p>The <code>OnlineLogging</code> module provides tools to monitor and report the simulation progress and other information of simulations.</p><p>Currently, the only feature implemented is timing report, to print information about current step, simulation time, and average performance. With <code>report_walltime</code>, you will see progress information like the following</p><pre><code class="nohighlight hljs">┌ Info: Progress
│   simulation_time = &quot;2 seconds&quot;
│   n_steps_completed = 20
│   wall_time_per_step = &quot;10 milliseconds, 100 microseconds&quot;
│   wall_time_total = &quot;1 second, 10 milliseconds&quot;
│   wall_time_remaining = &quot;808 milliseconds, 35 microseconds&quot;
│   wall_time_spent = &quot;202 milliseconds, 8 microseconds&quot;
│   percent_complete = &quot;20.0%&quot;
│   estimated_sypd = &quot;0.027&quot;
│   date_now = 2024-12-03T16:01:13.660
└   estimated_finish_date = 2024-12-03T16:01:14.660</code></pre><h2 id="WallTimeInfo-and-report_walltime"><a class="docs-heading-anchor" href="#WallTimeInfo-and-report_walltime"><code>WallTimeInfo</code> and <code>report_walltime</code></a><a id="WallTimeInfo-and-report_walltime-1"></a><a class="docs-heading-anchor-permalink" href="#WallTimeInfo-and-report_walltime" title="Permalink"></a></h2><p><code>WallTimeInfo</code> is a struct that holds information about wall time (the time you see on your watch, not the simulation time) and that can be used to report timing information with <a href="#ClimaUtilities.OnlineLogging.report_walltime"><code>report_walltime</code></a>.</p><p><code>WallTimeInfo</code> keeps track and accumulates how much time has elapsed since the last time it was updated. In this, <code>WallTimeInfo</code> tries to automatically remove the compilation overhead that your simulation might run into in the first step (this is accomplished by ignoring the first step and doubling the cost of the second step to compensate).</p><p>The simplest way to use <code>WallTimeInfo</code> is to make <code>report_walltime</code> a callback. Here is an example using a <code>SciML</code> integrator</p><pre><code class="language-julia hljs">import SciMLBase
import ClimaUtilities.OnlineLogging: WallTimeInfo, report_walltime
# Create the WallTimeInfo
wt = WallTimeInfo()

# Define a schedule that defines how often to report. Here, we follow the signature
# required by SciML. This function is triggered every 10 steps
function every10steps(u, t, integrator)
    return mod(integrator.step, 10) == 0
end

# Next, define the callback
report_callback = SciMLBase.DiscreteCallback(every10steps,
    let wt = wt
        integrator -&gt; report_walltime(wt, integrator)
    end)

# The let wt = wt is not strickly required, but it can improve type-stability and performance

# Now that we have the callback, we can pass it to the SciML constructor for the integrator</code></pre><div class="admonition is-category-todo"><header class="admonition-header">Todo</header><div class="admonition-body"><p>Describe schedules when we add them to <code>ClimaUtilities</code></p></div></div><p>The <code>report_walltime</code> function prints various timing statistics:</p><ul><li><strong><code>simulation_time</code>:</strong> The elapsed time within the simulation.</li><li><strong><code>n_steps_completed</code>:</strong> The number of simulation steps completed.</li><li><strong><code>wall_time_per_step</code>:</strong> The average wall clock time per step.</li><li><strong><code>wall_time_total</code>:</strong> Estimated total wall clock time for the simulation.</li><li><strong><code>wall_time_remaining</code>:</strong> Estimated remaining wall clock time.</li><li><strong><code>wall_time_spent</code>:</strong> Total wall clock time already spent.</li><li><strong><code>percent_complete</code>:</strong> Percentage of the simulation completed.</li><li><strong><code>estimated_sypd</code>:</strong> Estimated simulated years per day (or days per day if the rate is slow).</li><li><strong><code>date_now</code>:</strong> The current date and time.</li><li><strong><code>estimated_finish_date</code>:</strong> The estimated date and time of completion.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The estimated values (like <code>wall_time_remaining</code> and <code>estimated_sypd</code>) are based on the average wall time per step and can fluctuate, especially early in the simulation.  They become more reliable as the simulation progresses.</p></div></div><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.OnlineLogging.WallTimeInfo" href="#ClimaUtilities.OnlineLogging.WallTimeInfo"><code>ClimaUtilities.OnlineLogging.WallTimeInfo</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">WallTimeInfo</code></pre><p>Hold information about wall time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/39333689ff186cec877b8dfe223fa86a45f68805/src/OnlineLogging.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.OnlineLogging.report_walltime" href="#ClimaUtilities.OnlineLogging.report_walltime"><code>ClimaUtilities.OnlineLogging.report_walltime</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">report_walltime(wt::WallTimeInfo, integrator)</code></pre><p>Report the current progress and estimated completion time of a simulation.</p><p>This function calculates and displays various timing statistics based on the provided <code>WallTimeInfo</code> (<code>wt</code>) and the <code>integrator</code> state. It estimates the remaining wall time, total simulation time, and simulated time per real-time unit.</p><p>Prints a summary of the simulation progress to the console, including:</p><ul><li><code>simulation_time</code>: The current simulated time.</li><li><code>n_steps_completed</code>: The number of completed steps.</li><li><code>wall_time_per_step</code>: Average wall time per simulation step. You should expect this to be                       unreliable until the number of completed steps is large.</li><li><code>wall_time_total</code>: Estimated total wall time for the simulation. You should expect this to be                    unreliable until the number of completed steps is large.</li><li><code>wall_time_remaining</code>: Estimated remaining wall time. You should expect this to be                        unreliable until the number of completed steps is large.</li><li><code>wall_time_spent</code>: Total wall time spent so far.</li><li><code>percent_complete</code>: Percentage of the simulation completed.</li><li><code>estimated_sypd</code>: Estimated simulated years per day (or simulated days per day if sypd is                   very small). You should expect this to be unreliable until the number of                   completed steps is large.</li><li><code>date_now</code>: The current date and time.</li><li><code>estimated_finish_date</code>: The estimated date and time of simulation completion. You should                          expect this to be unreliable until the number of completed steps                          is large.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Average quantities and simulated-years-per-day are computed by taking the total time elapsed (minus initial compilation) and dividing by the number of steps completed. You should expect them to fluctuate heavily and to be unreliable until the number of steps become large. &quot;Large&quot; is defined by your problem: for example, the code has to go through all the callbacks and diagnostics a few times before stabilizing (and this is different for different simulations).</p></div></div><p><strong>Arguments:</strong></p><ul><li><code>wt::WallTimeInfo</code>:  A struct containing wall time information.</li><li><code>integrator</code>: The integrator object containing simulation state information, including the                current time <code>t</code>, timestep <code>dt</code>. It also have to have time span <code>tspan</code>                in <code>integrator.sol.prob.tspan</code>.</li></ul><p><strong>How to use <code>report_walltime</code></strong></p><p><code>report_walltime</code> is intended to be used as a callback executed at the end of a simulation step. The callback can be called with an arbitrary schedule, so that reporting can be customized.</p><p><strong>Example</strong></p><p>Suppose we want to report progress every 10 steps in a <code>SciMLBase</code>-type of integrator.</p><pre><code class="language-julia hljs">import ClimaUtilities.OnlineLogging: WallTimeInfo, report_progress
import SciMLBase

# Prepare the WallTimeInfo
walltime_info = WallTimeInfo()

# Define schedule, a boolean function that takes the integrator
every10steps(u, t, integrator) = mod(integrator.step, 10) == 0

# Define the callback, we use `let` to make this a little faster
report = let wt = walltime_info
     (integrator) -&gt; report_progress(wt, integrator)
end
report_callback = SciMLBase.DiscreteCallback(every10steps, report)

# Then, we can attach this callback to the integrator</code></pre><p>TODO: Discuss/link <code>Schedules</code> when we move them to <code>ClimaUtilities</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/39333689ff186cec877b8dfe223fa86a45f68805/src/OnlineLogging.jl#L66-L139">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../regridders/">« Regridders</a><a class="docs-footer-nextpage" href="../outputpathgenerator/">OutputPathGenerator »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 13 August 2025 18:54">Wednesday 13 August 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
