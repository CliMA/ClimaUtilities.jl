<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Regridders · ClimaUtilities.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaUtilities.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaUtilities.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../climaartifacts/">ClimaArtifacts</a></li><li><a class="tocitem" href="../inputs/">Space and Time Inputs</a></li><li><a class="tocitem" href="../filereaders/">FileReaders</a></li><li><a class="tocitem" href="../datahandling/">DataHandling</a></li><li class="is-active"><a class="tocitem" href>Regridders</a><ul class="internal"><li><a class="tocitem" href="#TempestRegridder"><span><code>TempestRegridder</code></span></a></li><li><a class="tocitem" href="#InterpolationsRegridder"><span><code>InterpolationsRegridder</code></span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li><li><a class="tocitem" href="../outputpathgenerator/">OutputPathGenerator</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Regridders</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Regridders</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaUtilities.jl/blob/main/docs/src/regridders.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Regridders"><a class="docs-heading-anchor" href="#Regridders">Regridders</a><a id="Regridders-1"></a><a class="docs-heading-anchor-permalink" href="#Regridders" title="Permalink"></a></h1><p>Simulations often need to import external data directly onto the computational grid. The <code>Regridders</code> module implements different schemes to accomplish this goal.</p><p>Currently, <code>Regridders</code> comes with two implementations:</p><ol><li><code>TempestRegridder</code> uses <a href="https://github.com/ClimateGlobalChange/tempestremap">TempestRemap</a> (through <code>ClimaCoreTempestRemap</code>) to perform conservative interpolation onto lat-long grids. <code>TempestRegridder</code> only works for single-threaded CPU runs and works directly with files.</li><li><code>InterpolationsRegridder</code> uses <a href="https://github.com/JuliaMath/Interpolations.jl">Interpolations.jl</a> to perform non-conservative linear interpolation onto lat-long(-z) grids. <code>InterpolationsRegridder</code> works directly with data.</li></ol><blockquote><p>⚠️ Note: While the <code>Regridders</code> can be used independently, most users will find their needs are immediately met by the <a href="../#SpaceVaryingInputs-and-TimeVaryingInputs"><code>SpaceVaryingInputs</code> and <code>TimeVaryingInputs</code></a> interfaces. These higher-level objects implement everything that is needed to read a file to the model grid (internally using the <code>Regridders</code>).</p></blockquote><p>If a regridder type is not specified by the user, and multiple are available, the <code>InterpolationsRegridder</code> will be used by default. At least one regridder extension must be loaded to be able to use regridding.</p><h2 id="TempestRegridder"><a class="docs-heading-anchor" href="#TempestRegridder"><code>TempestRegridder</code></a><a id="TempestRegridder-1"></a><a class="docs-heading-anchor-permalink" href="#TempestRegridder" title="Permalink"></a></h2><blockquote><p>This extension is loaded when loading <code>ClimaCoreTempestRemap</code></p></blockquote><p><code>TempestRegridder</code> performs conservative interpolation of lat-lon grids onto computational domains. <code>TempestRegridder</code> performs all the interpolation ahead of time and saves the regridded fields to HDF5 files that can be read during the simulation.</p><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>Assuming <code>target_space</code> is a <code>ClimaCore</code> 2D spherical field, the input data is the variable <code>u</code> in the file <code>era5_example.nc</code>, and we want to read the data associated with date <code>target_date</code>.</p><pre><code class="language-julia hljs">import ClimaUtilities.Regridders
import ClimaCoreTempestRemap
# Loading ClimaCoreTempest automatically loads TempestRegridder

reg = Regridders.TempestRegridder(target_space, &quot;regrid_output&quot;, &quot;u&quot;, &quot;era5_example.nc&quot;)
# When reg is created, the variable `u` is regridded and the output files
# are saved to the `regrid_output` folder

regridded_u = Regridders.regrid(reg, target_date)</code></pre><h2 id="InterpolationsRegridder"><a class="docs-heading-anchor" href="#InterpolationsRegridder"><code>InterpolationsRegridder</code></a><a id="InterpolationsRegridder-1"></a><a class="docs-heading-anchor-permalink" href="#InterpolationsRegridder" title="Permalink"></a></h2><blockquote><p>This extension is loaded when loading <code>ClimaCore</code> and <code>Interpolations</code></p></blockquote><p><code>InterpolationsRegridder</code> performs linear interpolation of input data (linear along each direction) and returns a <code>ClimaCore</code> <code>Field</code> defined on the <code>target_space</code>.</p><p>Currently, <code>InterpolationsRegridder</code> only supports spherical shells and extruded spherical shells (but it could be easily extended to other domains).</p><blockquote><p>Note: it is easy to change the spatial interpolation type and extrapolation conditions, if needed.</p></blockquote><p><code>InterpolationsRegridder</code> are created once, they are tied to a <code>target_space</code>, but can be used with any input data. With MPI runs, every process computes the interpolating function. This is always done on the CPU and moved to GPU for accelerated runs.</p><h3 id="Example-2"><a class="docs-heading-anchor" href="#Example-2">Example</a><a class="docs-heading-anchor-permalink" href="#Example-2" title="Permalink"></a></h3><p>Assuming <code>target_space</code> is a <code>ClimaCore</code> 2D spherical field.</p><pre><code class="language-julia hljs">import ClimaUtilities.Regridders
import ClimaCore, Interpolations
# Loading ClimaCore and Interpolations automatically loads InterpolationsRegridder

reg = Regridders.InterpolationsRegridder(target_space)

# Now we can regrid any data
lon = collect(-180:1:180)
lat = collect(-90:1:90)
# It has to be lon, lat (because this is the assumed order in the CF conventions)
dimensions = (lon, lat)

data = rand((length(lon), length(lat)))

interpolated_data = Regridders.InterpolationsRegridder(reg, data, dimensions)
interpolated_2data = Regridders.InterpolationsRegridder(reg, 2 .* data, dimensions)</code></pre><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.Regridders.TempestRegridder" href="#ClimaUtilities.Regridders.TempestRegridder"><code>ClimaUtilities.Regridders.TempestRegridder</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">TempestRegridder(target_space::ClimaCore.Spaces.AbstractSpace,
                 input_file::AbstractString,
                 regrid_dir::AbstractString,
                 varname::AbstractString,
                 regrid_dir::AbstractString;
                 mono::Bool)</code></pre><p>Set up a <code>TempestRegridder</code> object to regrid the variable in the given <code>input_file</code> to the <code>target_space</code>. <code>TempestRegridder</code> works only on CPU and on a single process.</p><p><strong>Positional arguments</strong></p><ul><li><code>target_space</code>: the ClimaCore Space where the simulation is being performed.</li><li><code>input_file</code>: the path of the NetCDF file that has to be read and processed.</li><li><code>regrid_dir</code>: the path where to save the regrid files created by TempestRemap.</li><li><code>varname</code>: the name of the variable in the NetCDF file.</li><li><code>regrid_dir</code>: a folder where regridded Fields are saved as HDF5 files.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>mono</code>: Whether remapping has to be monotonic or not.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/cd89a6344449a5793a9e66bf54b8aea5ebd7114b/ext/TempestRegridderExt.jl#L45-L69">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.Regridders.InterpolationsRegridder" href="#ClimaUtilities.Regridders.InterpolationsRegridder"><code>ClimaUtilities.Regridders.InterpolationsRegridder</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">InterpolationsRegridder(target_space::ClimaCore.Spaces.AbstractSpace
                        [; extrapolation_bc::Tuple])</code></pre><p>An online regridder that uses Interpolations.jl</p><p>Currently, InterpolationsRegridder is only implemented for LatLong and LatLongZ spaces. It performs linear interpolation along each of the directions (separately). By default, it imposes periodic boundary conditions for longitude, flat for latitude, and throwing errors when extrapolating in z. This can be customized by passing the <code>extrapolation_bc</code> keyword argument.</p><p>InterpolationsRegridder is GPU and MPI compatible in the simplest possible way: each MPI process has the entire input data and everything is copied to GPU.</p><p><strong>Keyword arguments</strong></p><p>The optional keyword argument <code>extrapolation_bc</code> controls what should be done when the interpolation point is not in the domain of definition. This has to be a tuple of N elements, where N is the number of spatial dimensions. For 3D spaces, the default is <code>(Interpolations.Periodic(), Interpolations.Flat(), Interpolations.Throw())</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/cd89a6344449a5793a9e66bf54b8aea5ebd7114b/ext/InterpolationsRegridderExt.jl#L32-L54">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaUtilities.Regridders.regrid" href="#ClimaUtilities.Regridders.regrid"><code>ClimaUtilities.Regridders.regrid</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">regrid(regridder::InterpolationsRegridder, data, dimensions)::Field</code></pre><p>Regrid the given data as defined on the given dimensions to the <code>target_space</code> in <code>regridder</code>.</p><p>This function is allocating.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/cd89a6344449a5793a9e66bf54b8aea5ebd7114b/ext/InterpolationsRegridderExt.jl#L75-L81">source</a></section><section><div><pre><code class="nohighlight hljs">regrid(regridder::TempestRegridder, date::Dates.DateTime)</code></pre><p>Return the field associated to the <code>regridder</code> at the given <code>date</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaUtilities.jl/blob/cd89a6344449a5793a9e66bf54b8aea5ebd7114b/ext/TempestRegridderExt.jl#L115-L119">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../datahandling/">« DataHandling</a><a class="docs-footer-nextpage" href="../outputpathgenerator/">OutputPathGenerator »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 17 April 2024 00:03">Wednesday 17 April 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
