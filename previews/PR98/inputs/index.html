<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Space and Time Inputs · ClimaUtilities.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaUtilities.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaUtilities.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../climaartifacts/">ClimaArtifacts</a></li><li class="is-active"><a class="tocitem" href>Space and Time Inputs</a><ul class="internal"><li><a class="tocitem" href="#TimeVaryingInputs"><span><code>TimeVaryingInputs</code></span></a></li><li><a class="tocitem" href="#SpaceVaryingInputs"><span><code>SpaceVaryingInputs</code></span></a></li><li class="toplevel"><a class="tocitem" href="#Loading-ClimaCore,-NCDatasets,-ClimaCoreTempestRemap-loads-the-extensions-we-need"><span>Loading ClimaCore, NCDatasets, ClimaCoreTempestRemap loads the extensions we need</span></a></li><li class="toplevel"><a class="tocitem" href="#Albedo-as-an-analytic-function-of-lat-and-lon"><span>Albedo as an analytic function of lat and lon</span></a></li></ul></li><li><a class="tocitem" href="../filereaders/">FileReaders</a></li><li><a class="tocitem" href="../datahandling/">DataHandling</a></li><li><a class="tocitem" href="../regridders/">Regridders</a></li><li><a class="tocitem" href="../outputpathgenerator/">OutputPathGenerator</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Space and Time Inputs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Space and Time Inputs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaUtilities.jl/blob/main/docs/src/inputs.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="SpaceVaringInputs-and-TimeVaryingInputs"><a class="docs-heading-anchor" href="#SpaceVaringInputs-and-TimeVaryingInputs"><code>SpaceVaringInputs</code> and <code>TimeVaryingInputs</code></a><a id="SpaceVaringInputs-and-TimeVaryingInputs-1"></a><a class="docs-heading-anchor-permalink" href="#SpaceVaringInputs-and-TimeVaryingInputs" title="Permalink"></a></h1><p>Most models require external inputs to work. Examples of inputs are an analytic function that prescribes the sea-surface temperature in time, or a file that describes the types of plants on the surface of the globe. The <code>SpaceVaringInputs</code> and <code>TimeVaryingInputs</code> modules provide a unified infrastructure to handle all these cases.</p><h2 id="TimeVaryingInputs"><a class="docs-heading-anchor" href="#TimeVaryingInputs"><code>TimeVaryingInputs</code></a><a id="TimeVaryingInputs-1"></a><a class="docs-heading-anchor-permalink" href="#TimeVaryingInputs" title="Permalink"></a></h2><blockquote><p>This extension is loaded when loading <code>ClimaCore</code> is loaded. In addition to this, if NetCDF files are used, <code>NCDatasets</code> has to be loaded too. Finally, a <code>Regridder</code> is needed (which might require importing additional packages).</p></blockquote><p>A <code>TimeVaryingInput</code> is an object that knows how to fill a <code>ClimaCore</code> <code>Field</code> at a given simulation time <code>t</code>. <code>TimeVaryingInputs</code> can be constructed in a variety of ways, from using analytic functions, to NetCDF data. They expose one interface, <code>evaluate!(dest_field, tv, time)</code>, which can be used by model developers to update their <code>Field</code>s.</p><p>This example shows that <code>TimeVaryingInput</code> can take different types of inputs and be used with a single interface (<code>evaluate!</code>). In all of this, <code>TimeVaryingInput</code>s internally handle all the complexity related to reading files (using <a href="@ref"><code>FileReaders</code></a>), dealing with parallelism and GPUs, regridding onto the computational domains (using <a href="@ref"><code>Regridders</code></a> and <a href="@ref"><code>DataHandling</code></a>), and so on.</p><p><code>TimeVaryingInputs</code> support:</p><ul><li>analytic functions of time;</li><li>pairs of 1D arrays (for <code>PointSpaces</code>);</li><li>2/3D NetCDF files;</li><li>linear interpolation in time (default), nearest neighbors, and &quot;period filling&quot;;</li><li>boundary conditions and repeating periodic data.</li></ul><p>It is possible to pass down keyword arguments to underlying constructors in the <code>Regridder</code> with the <code>regridder_kwargs</code> and <code>file_reader_kwargs</code>. These have to be a named tuple or a dictionary that maps <code>Symbol</code>s to values.</p><h3 id="Extrapolation-boundary-conditions"><a class="docs-heading-anchor" href="#Extrapolation-boundary-conditions">Extrapolation boundary conditions</a><a id="Extrapolation-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Extrapolation-boundary-conditions" title="Permalink"></a></h3><p><code>TimeVaryingInput</code>s can have multiple boundary conditions for extrapolation. By default, the <code>Throw</code> condition is used, meaning that interpolating onto a point that is outside the range of definition of the data is not allowed. Other boundary conditions are allowed. With the <code>Flat</code> boundary condition, when interpolating outside of the range of definition, return the value of the of closest boundary is used instead.</p><p>Another boundary condition that is often useful is <code>PeriodicCalendar</code>, which repeats data over and over.</p><p>In general <code>PeriodicCalendar</code> takes two inputs: the <code>period</code> and <code>repeat_date</code>. The repeat period is a <code>Dates.DatePeriod</code> (e.g., <code>Dates.Year(1)</code>) that defines the duration of the period that has to be repeated. The <code>repeat_date</code> defines what date range needs to be repeated. For example, if <code>period = Dates.Month(1)</code> and <code>repeat_date = Dates.Date(1993, 11)</code>, November 1993 will be repeated.</p><p>The two inputs are not required. When they are not provided, <code>ClimaUtilities</code> will assume that the input data constitutes one period and use that. For example, if the data is defined from <code>t0</code> to <code>t1</code> (e.g., 1 and 5), interpolating over <code>t &gt; t1</code> (e.g., 7) is equivalent to interpolating to <code>t*</code> where <code>t*</code> is the modulus of <code>t</code> and the range (3 in this case). In this case, <code>PeriodicCalendar</code> requires the data to be uniformly spaced in time. To enable this boundary condition, pass <code>LinearInterpolation(PeriodicCalendar())</code> to the <code>TimeVaryingInput</code> (or <code>NearestNeighbor(PeriodicCalendar())</code>).</p><blockquote><p>Note: this <code>PeriodicCalendar</code> is different from what you might be used to, where the identification is <code>t1 = t0</code>. Here, we identify <code>t1 + dt = t0</code>. This is so that we can use it to repeat calendar data.</p></blockquote><h3 id="LinearPeriodFillingInterpolation"><a class="docs-heading-anchor" href="#LinearPeriodFillingInterpolation"><code>LinearPeriodFillingInterpolation</code></a><a id="LinearPeriodFillingInterpolation-1"></a><a class="docs-heading-anchor-permalink" href="#LinearPeriodFillingInterpolation" title="Permalink"></a></h3><p>Often, data is not available at the frequency we would like it to be. For example, we might have hourly data for a given quantity but only on the 15th of the month. Performing linear interpolation with data with this type of gap is typically not accurate. Consider the example of a quantity with a diurnal cycle but measured only once a month. If we were to blindly perform linear interpolation, we would find that the diurnal cycle is completely removed for every day of the month but the 15th. This is because we would interpolate the last point for the day of a given month, with the first for the following.</p><p><code>LinearPeriodFillingInterpolation</code> is an interpolation method that solves this problem by preserving periodic structures. This is accomplished by performing linear interpolation across corresponding periods (in the case of the day, across corresponding hours of different days). For more information, please refer to the docstring.</p><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>Let <code>target_space</code> be the computational domain (a <code>ClimaCore</code> <code>Space</code>) and <code>cesm_albedo.nc</code> a NetCDF file containing albedo data as a function of time in a variable named <code>alb</code>.</p><pre><code class="language-julia hljs">import ClimaUtilities: TimeVaryingInputs
import ClimaCore
import NCDatasets
import ClimaCoreTempestRemap
# Loading ClimaCore, NCDatasets, ClimaCoreTempestRemap loads the extensions we need

function evolve_model(albedo_tv, albedo_field)
    new_t = t + dt
    # First, we update the albedo to the new time
    evaluate!(albedo_field, albedo_tv, new_t)
    # Now we can do all the operations we want we albedo_filed
    # rhs = ...
end

# Let us prepare an empty Field that will contain the albedo
albedo_field = zero(target_space)

# If the albedo is an analytic function of time
albedo_tv_an = TimeVaryingInput((t) -&gt; 0.5)

# If the albedo comes from data

# reference_date is the calendar date at the beginning of our simulation
reference_date = Dates.DateTime(2000, 1, 1)
albedo_tv = TimeVaryingInputs.TimeVaryingInput(&quot;cesem_albedo.nc&quot;, &quot;alb&quot;, target_space;
                                               reference_date, regridder_kwargs = (; regrid_dir = &quot;/tmp&quot;))
# When using data from files, the data is automatically interpolated to the correct
# time

# In either cases, we can always call evolve_model(albedo_tv, albedo_field), so
# model developers do not have to worry about anything :)</code></pre><h2 id="SpaceVaryingInputs"><a class="docs-heading-anchor" href="#SpaceVaryingInputs"><code>SpaceVaryingInputs</code></a><a id="SpaceVaryingInputs-1"></a><a class="docs-heading-anchor-permalink" href="#SpaceVaryingInputs" title="Permalink"></a></h2><blockquote><p>This extension is loaded when loading <code>ClimaCore</code> is loaded. In addition to this, if NetCDF files are used, <code>NCDatasets</code> has to be loaded too. Finally, a <code>Regridder</code> is needed (which might require importing additional packages).</p></blockquote><p><code>SpaceVaryingInput</code>s uses the same building blocks as <code>TimeVaryingInput</code> (chiefly the <a href="@ref"><code>DataHandling</code></a> module) to construct a <code>Field</code> from different sources.</p><p><code>TimeVaryingInputs</code> support:</p><ul><li>analytic functions of coordinates;</li><li>pairs of 1D arrays (for columns);</li><li>2/3D NetCDF files.</li></ul><p>In some ways, a <code>SpaceVaryingInput</code> can be thought as an alternative constructor for a <code>ClimaCore</code> <code>Field</code>.</p><p>It is possible to pass down keyword arguments to underlying constructors in the <code>Regridder</code> with the <code>regridder_kwargs</code> and <code>file_reader_kwargs</code>. These have to be a named tuple or a dictionary that maps <code>Symbol</code>s to values.</p><h3 id="Example-2"><a class="docs-heading-anchor" href="#Example-2">Example</a><a class="docs-heading-anchor-permalink" href="#Example-2" title="Permalink"></a></h3><p>Let <code>target_space</code> be a <code>ClimaCore</code> <code>Space</code> where we want the <code>Field</code> to be defined on and <code>cesm_albedo.nc</code> a NetCDF file containing albedo data as a time in a variable named <code>alb</code>.</p><pre><code class="language-julia hljs"></code></pre><p>julia import ClimaUtilities: SpaceVaryingInputs import ClimaCore import NCDatasets import ClimaCoreTempestRemap</p><h1 id="Loading-ClimaCore,-NCDatasets,-ClimaCoreTempestRemap-loads-the-extensions-we-need"><a class="docs-heading-anchor" href="#Loading-ClimaCore,-NCDatasets,-ClimaCoreTempestRemap-loads-the-extensions-we-need">Loading ClimaCore, NCDatasets, ClimaCoreTempestRemap loads the extensions we need</a><a id="Loading-ClimaCore,-NCDatasets,-ClimaCoreTempestRemap-loads-the-extensions-we-need-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-ClimaCore,-NCDatasets,-ClimaCoreTempestRemap-loads-the-extensions-we-need" title="Permalink"></a></h1><h1 id="Albedo-as-an-analytic-function-of-lat-and-lon"><a class="docs-heading-anchor" href="#Albedo-as-an-analytic-function-of-lat-and-lon">Albedo as an analytic function of lat and lon</a><a id="Albedo-as-an-analytic-function-of-lat-and-lon-1"></a><a class="docs-heading-anchor-permalink" href="#Albedo-as-an-analytic-function-of-lat-and-lon" title="Permalink"></a></h1><p>albedo<em>latlon</em>fun = (coord) -&gt; 0.5 * coord.long * coord.lat</p><p>albedo = SpaceVaryingInputs.SpaceVaryingInput(albedo<em>latlon</em>fun)</p><p>albedo<em>from</em>file = SpaceVaryingInputs.SpaceVaryingInput(&quot;cesm<em>albedo.nc&quot;, &quot;alb&quot;, target</em>space, regridder<em>kwargs = (; regrid</em>dir = &quot;/tmp&quot;))</p><pre><code class="nohighlight hljs">
## API
</code></pre><p>@docs ClimaUtilities.SpaceVaryingInputs.SpaceVaryingInput ClimaUtilities.TimeVaryingInputs.AbstractInterpolationMethod ClimaUtilities.TimeVaryingInputs.AbstractInterpolationBoundaryMethod ClimaUtilities.TimeVaryingInputs.NearestNeighbor ClimaUtilities.TimeVaryingInputs.LinearInterpolation ClimaUtilities.TimeVaryingInputs.Throw ClimaUtilities.TimeVaryingInputs.PeriodicCalendar ClimaUtilities.TimeVaryingInputs.Flat ClimaUtilities.TimeVaryingInputs.evaluate! ClimaUtilities.TimeVaryingInputs.extrapolation_bc Base.in Base.close ```</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../climaartifacts/">« ClimaArtifacts</a><a class="docs-footer-nextpage" href="../filereaders/">FileReaders »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 17 August 2024 05:34">Saturday 17 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
