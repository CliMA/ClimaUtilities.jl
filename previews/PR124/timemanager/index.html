<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>TimeManager · ClimaUtilities.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaUtilities.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaUtilities.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../climaartifacts/">ClimaArtifacts</a></li><li><a class="tocitem" href="../inputs/">Space and Time Inputs</a></li><li><a class="tocitem" href="../filereaders/">FileReaders</a></li><li><a class="tocitem" href="../datahandling/">DataHandling</a></li><li><a class="tocitem" href="../regridders/">Regridders</a></li><li><a class="tocitem" href="../outputpathgenerator/">OutputPathGenerator</a></li><li class="is-active"><a class="tocitem" href>TimeManager</a><ul class="internal"><li><a class="tocitem" href="#ITime"><span><code>ITime</code></span></a></li><li><a class="tocitem" href="#Developer-notes"><span>Developer notes</span></a></li></ul></li><li><a class="tocitem" href="../faqs/">Frequently Asked Questions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>TimeManager</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>TimeManager</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaUtilities.jl/blob/main/docs/src/timemanager.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="TimeManager"><a class="docs-heading-anchor" href="#TimeManager">TimeManager</a><a id="TimeManager-1"></a><a class="docs-heading-anchor-permalink" href="#TimeManager" title="Permalink"></a></h1><p><code>TimeManager</code> defines <code>ITime</code>, the time type for CliMA simulations, alongside with various functions to work with it.</p><h2 id="ITime"><a class="docs-heading-anchor" href="#ITime"><code>ITime</code></a><a id="ITime-1"></a><a class="docs-heading-anchor-permalink" href="#ITime" title="Permalink"></a></h2><p><code>ITime</code> is a type to describe times and dates. The &quot;I&quot; in <code>ITime</code> stands for <em>integer</em>: internally, <code>ITime</code> uses integers to represent times and dates, meaning that operations with <code>ITime</code> are exact and do not occur in floating-point errors.</p><p><code>ITime</code> can be thought a combination of three quantities, a <code>counter</code>, a <code>period</code>, and (optionally) a <code>start_date</code>, with the <code>counter</code> counting how many <code>period</code>s have elapsed since <code>start_date</code>. In other words, <code>ITime</code> counts clock cycles from an epoch, with each clock cycle lasting a <code>period</code>.</p><p>Another useful mental model for <code>ITime</code> is that it is a time with some units. It is useful to keep this abstraction in mind when working with binary operations that involve <code>ITime</code>s because it helps with determining the output type of the operation (more on this later).</p><p>Let us start getting familiar with <code>ITime</code> by exploring some basic operations.</p><h3 id="First-steps-with-ITime"><a class="docs-heading-anchor" href="#First-steps-with-ITime">First steps with <code>ITime</code></a><a id="First-steps-with-ITime-1"></a><a class="docs-heading-anchor-permalink" href="#First-steps-with-ITime" title="Permalink"></a></h3><p>The first step in using <code>ITime</code> is to load it. You can load <code>ITime</code> by loading the <code>TimeManager</code> module as in the following:</p><pre><code class="language-julia hljs">using ClimaUtilities.TimeManager</code></pre><p>This will load <code>ITime</code> as well as some other utilities. If you only wish to load <code>ITime</code>, you can change <code>using</code> with <code>import</code> and explicitly ask for <code>ITime</code></p><pre><code class="language- hljs">import ClimaUtilities.TimeManager: ITime</code></pre><p>In these examples, we will stick with <code>using ClimaUtilites.TimeManager</code> because we will call other functions as well.</p><p>By default, <code>ITime</code> assumes that the clock cycle is one second:</p><pre><code class="language-julia hljs">ITime(5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5 seconds [counter = 5, period = 1 second]</code></pre><p>The output that is printed shows the time represented (5 seconds), and its break down into the integer counter (5) and the duration of each clock cycle (1 second). </p><p>This <code>ITime</code> does not come with any date information attached to it. To add it, you can pass the <code>start_date</code> keyword</p><pre><code class="language-julia hljs">using Dates
ITime(5; start_date = DateTime(2012, 12, 21))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5 seconds (2012-12-21T00:00:05) [counter = 5, period = 1 second, start_date = 2012-12-21T00:00:00]</code></pre><p>Now, the output also reports <code>start_date</code> and current date (5 seconds after midnight of the 21st of December 2012).</p><p>The period can also be customized with the <code>period</code> keyword. This keyword accepts any <code>Dates.FixedPeriod</code> (fixed periods are intervals of time that have a fixed duration, such as <code>Week</code>, but unlike <code>Month</code>), for example</p><pre><code class="language-julia hljs">time1 = ITime(5; period = Hour(20), start_date = DateTime(2012, 12, 21))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100 hours (2012-12-25T04:00:00) [counter = 5, period = 20 hours, start_date = 2012-12-21T00:00:00]</code></pre><p>All these quantities are accessible with functions:</p><pre><code class="language-julia hljs">@show &quot;time1&quot; counter(time1) period(time1) start_date(time1) date(time1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2012-12-25T04:00:00</code></pre><p>Now that we know how to create <code>ITime</code>s, we can manipulate them. <code>ITime</code>s support most (but not all) arithmetic operations.</p><p>For <code>ITime</code>s with a <code>start_date</code>, it is only possible to combine <code>ITime</code>s that have the same <code>start_date</code>. <code>ITime</code>s can be composed to other times and arithmetic operations propagate <code>start_date</code>s.</p><p>This works:</p><pre><code class="language-julia hljs">time1 = ITime(5; start_date = DateTime(2012, 12, 21))
time2 = ITime(15; start_date = DateTime(2012, 12, 21))
time1 + time2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">20 seconds (2012-12-21T00:00:20) [counter = 20, period = 1 second, start_date = 2012-12-21T00:00:00]</code></pre><p>This works too</p><pre><code class="language-julia hljs">time1 = ITime(5; start_date = DateTime(2012, 12, 21))
time2 = ITime(15)
time1 + time2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">20 seconds (2012-12-21T00:00:20) [counter = 20, period = 1 second, start_date = 2012-12-21T00:00:00]</code></pre><p>This does not work because the two <code>ITimes</code> don&#39;t have the same <code>start_date</code></p><pre><code class="language- hljs">time1 = ITime(5; start_date = DateTime(2012, 12, 21))
time2 = ITime(15; start_date = DateTime(2025, 12, 21))
time1 + time2</code></pre><p>When dealing with binary operations, it is convenient to think of <code>ITimes</code> as dimensional quantities (quantities with units). In the previous examples, addition returns a new <code>ITimes</code>. Division will behave differently </p><pre><code class="language-julia hljs">time1 = ITime(15)
time2 = ITime(5)
time1 / time2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3//1</code></pre><p>In this case, the return value is just a number (essentially, we divided 15 seconds by 5 seconds, resulting the dimensionless factor of 3).</p><p>Similarly, adding a number to an <code>ITime</code> is not allowed (because the number doesn&#39;t have units), but multiplying by is fine.</p><p>In the same spirit, when <code>ITime</code>s with different <code>periods</code> are combined, units are transformed to the </p><pre><code class="language-julia hljs">time1 = ITime(5; period = Hour(1))
time2 = ITime(1; period = Minute(25))
time1 - time2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">275 minutes [counter = 55, period = 5 minutes]</code></pre><p>As we can see, the return value of 5 hours - 25 minutes is 275 minutes and it is represented as 55 clock cycles of a period of 5 minutes. <code>Minute(5)</code> was picked because it the greatest common divisor between <code>Hour(1)</code> and <code>Minute(25)</code>.</p><p>At any point, we can obtain a date or a number of seconds from an <code>ITime</code>:</p><pre><code class="language-julia hljs">time1 = ITime(5; period = Day(10), start_date = DateTime(2012, 12, 21))
date(time1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2013-02-09T00:00:00</code></pre><p>And</p><pre><code class="language-julia hljs">time1 = ITime(5; period = Day(10), start_date = DateTime(2012, 12, 21))
seconds(time1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4.32e6</code></pre><p>In this, note that the <code>seconds</code> function always returns a Float64.</p><p>In this section, we saw that <code>ITime</code>s can be used to represent dates and times and manipulated in a natural way.</p><p><code>ITime</code>s support another feature, fractional times, useful for further partitioning an interval of time.</p><h3 id="Fractional-times"><a class="docs-heading-anchor" href="#Fractional-times">Fractional times</a><a id="Fractional-times-1"></a><a class="docs-heading-anchor-permalink" href="#Fractional-times" title="Permalink"></a></h3><p>Sometimes, one need to work with fractions of a <code>period</code>. The primary application of this is timestepping loops, which are typically divided in stages which are a fraction of a timestep.</p><p><code>ITime</code>s can represent fractions of a <code>period</code> using rational numbers. For example</p><pre><code class="language- hljs">time1 = ITime(5)
time1 / 2</code></pre><p>Here, we can see that the counter is now <code>5//2</code> (the fraction 5 divided by 2). Only integer and rational counters are allowed.</p><p><code>ITime</code>s with fractional counters largely behave as <code>ITime</code>s with integer counters with the exception that it is generally not possible to covert them to dates without rounding. Given that Julia&#39;s Dates follow the UNIX representation by being encoded with the number of milliseconds from an epoch, we also truncate fractions to milliseconds when converting to dates.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"></div></div><p>The current implementation of fractional times uses the <code>Rational</code> module in the   standard library. This might have performance implications. Please, open an   issue if you have any.</p><h3 id="How-to-use-ITimes-in-packages"><a class="docs-heading-anchor" href="#How-to-use-ITimes-in-packages">How to use <code>ITime</code>s in packages</a><a id="How-to-use-ITimes-in-packages-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-use-ITimes-in-packages" title="Permalink"></a></h3><p>The two key interfaces to work with <code>ITime</code>s are <a href="@ref"><code>seconds</code></a> and <a href="@ref"><code>date</code></a>, which respectively return the time as Float64 number of seconds and the associated <code>DateTime</code>.</p><p>If you want to support <code>AbstractFloat</code>s and <code>ITime</code>s, some useful functions are <code>float</code> (which returns the number of seconds as a Float64), <code>zero</code>, <code>one</code>, and <code>oneunit</code>. The difference between <code>one</code> and <code>oneunit</code> is that the latter returns a <code>ITime</code> type, while the former returns a number. This is not what happens with <code>zero</code>, which returns an <code>ITime</code>.</p><p>You might have the temptation to just sprinkle <code>float</code> everywhere to transition your code to using <code>ITime</code>s. Resist to this temptation because it might defy the purpose of using integer times in the first place.</p><p>For typical codes and simulation, we recommend only setting <code>t_start</code> and <code>t_end</code> with a <code>start_date</code>: the <code>start_date</code> will be propagated naturally to all the other times involved in the calculations. </p><p>Regarding the question on what <code>period</code> to use: if there are natural periods (e.g., you are dealing with an hourly diagnostic variable), use it, otherwise you can stick with the default. The <code>period</code> can always be changed by setting it in <code>t_start</code> and <code>t_end</code>.</p><p>We provide a constructor from floating point numbers to assist you in transitioning your package to using <code>ITime</code>s. This constructor guesses and uses the largest period that can be used to properly represent the data.</p><pre><code class="language-julia hljs">ITime(60.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1 minute [counter = 1, period = 1 minute]</code></pre><h2 id="Developer-notes"><a class="docs-heading-anchor" href="#Developer-notes">Developer notes</a><a id="Developer-notes-1"></a><a class="docs-heading-anchor-permalink" href="#Developer-notes" title="Permalink"></a></h2><h3 id="Why-not-using-Dates-directly?"><a class="docs-heading-anchor" href="#Why-not-using-Dates-directly?">Why not using <code>Dates</code> directly?</a><a id="Why-not-using-Dates-directly?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-not-using-Dates-directly?" title="Permalink"></a></h3><p>Periods in Julia&#39;s <code>Dates</code> are also implemented as integer counters attached to a type that encode its units. So why not using them directly?</p><p>There are a few reasons why <code>ITime</code> is preferred over Julia&#39;s <code>Dates</code>:</p><ul><li><code>Dates</code> do not support fractional intervals, which are needed for the timestepping loop;</li><li><code>Dates</code> only support the Gregorian calendar. <code>ITime</code> provides an abstraction layer that will allow us to support other calendars without changing packages;</li><li><code>Dates</code> only allow the given periods, but it often natural to pick the simulation timestep as <code>period</code>;</li><li>Julia&#39;s <code>Dates</code> are not necessarily faster or better and, being part of the standard library, means that it is hard to improve them.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../outputpathgenerator/">« OutputPathGenerator</a><a class="docs-footer-nextpage" href="../faqs/">Frequently Asked Questions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 7 November 2024 17:07">Thursday 7 November 2024</span>. Using Julia version 1.10.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
